{"ast":null,"code":"import assert from \"assert\";\nimport { PublicKey, Transaction, TransactionInstruction } from \"@solana/web3.js\";\nimport { chunks } from \"../utils/common\";\nimport { translateAddress } from \"../program/common\";\nimport { getProvider } from \"../provider\";\n/**\n * Sends a transaction to a program with the given accounts and instruction\n * data.\n */\n\nexport async function invoke(programId, accounts, data, provider) {\n  programId = translateAddress(programId);\n\n  if (!provider) {\n    provider = getProvider();\n  }\n\n  const tx = new Transaction();\n  tx.add(new TransactionInstruction({\n    programId,\n    keys: accounts !== null && accounts !== void 0 ? accounts : [],\n    data\n  }));\n  return await provider.send(tx);\n}\nconst GET_MULTIPLE_ACCOUNTS_LIMIT = 99;\nexport async function getMultipleAccounts(connection, publicKeys) {\n  if (publicKeys.length <= GET_MULTIPLE_ACCOUNTS_LIMIT) {\n    return await getMultipleAccountsCore(connection, publicKeys);\n  } else {\n    const batches = chunks(publicKeys, GET_MULTIPLE_ACCOUNTS_LIMIT);\n    const results = await Promise.all(batches.map(batch => getMultipleAccountsCore(connection, batch)));\n    return results.flat();\n  }\n}\n\nasync function getMultipleAccountsCore(connection, publicKeys) {\n  const args = [publicKeys.map(k => k.toBase58()), {\n    commitment: \"recent\"\n  }]; // @ts-ignore\n\n  const res = await connection._rpcRequest(\"getMultipleAccounts\", args);\n\n  if (res.error) {\n    throw new Error(\"failed to get info about accounts \" + publicKeys.map(k => k.toBase58()).join(\", \") + \": \" + res.error.message);\n  }\n\n  assert(typeof res.result !== \"undefined\");\n  const accounts = [];\n\n  for (const account of res.result.value) {\n    let value = null;\n\n    if (account === null) {\n      accounts.push(null);\n      continue;\n    }\n\n    if (res.result.value) {\n      const {\n        executable,\n        owner,\n        lamports,\n        data\n      } = account;\n      assert(data[1] === \"base64\");\n      value = {\n        executable,\n        owner: new PublicKey(owner),\n        lamports,\n        data: Buffer.from(data[0], \"base64\")\n      };\n    }\n\n    if (value === null) {\n      throw new Error(\"Invalid response\");\n    }\n\n    accounts.push(value);\n  }\n\n  return accounts.map((account, idx) => {\n    if (account === null) {\n      return null;\n    }\n\n    return {\n      publicKey: publicKeys[idx],\n      account\n    };\n  });\n}","map":{"version":3,"mappings":"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","names":["assert","PublicKey","Transaction","TransactionInstruction","chunks","translateAddress","getProvider","invoke","programId","accounts","data","provider","tx","add","keys","send","GET_MULTIPLE_ACCOUNTS_LIMIT","getMultipleAccounts","connection","publicKeys","length","getMultipleAccountsCore","batches","results","Promise","all","map","batch","flat","args","k","toBase58","commitment","res","_rpcRequest","error","Error","join","message","result","account","value","push","executable","owner","lamports","Buffer","from","idx","publicKey"],"sourceRoot":"","sources":["../../../src/utils/rpc.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}