{"ast":null,"code":"var _jsxFileName = \"/Users/komalfulwar/Downloads/candy-machine-ui/src/Home.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useMemo, useState, useCallback } from \"react\";\nimport * as anchor from \"@project-serum/anchor\";\nimport styled from \"styled-components\";\nimport { useWallet } from \"@solana/wallet-adapter-react\";\nimport { WalletDialogButton } from \"@solana/wallet-adapter-material-ui\";\nimport { toDate, getAtaForMint } from \"./utils\";\nimport Header from \"./header/Header\";\nimport Body from \"./body/body\";\nimport { getAllNft } from \"./service/api\";\nimport Pagination from \"@mui/material/Pagination\";\nimport { totalNfts } from \"./utils/constants\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ConnectButton = styled(WalletDialogButton)`\n  width: 100%;\n  height: 60px;\n  margin-top: 10px;\n  margin-bottom: 5px;\n  background: linear-gradient(180deg, #604ae5 0%, #813eee 100%);\n  color: white;\n  font-size: 16px;\n  font-weight: bold;\n`;\nconst MintContainer = styled.div``; // add your owns styles here\n\nconst Home = props => {\n  _s();\n\n  const [page, setPage] = useState(0);\n  const [isUserMinting, setIsUserMinting] = useState(false);\n  const [nft, setNft] = useState([]);\n  const [candyMachine, setCandyMachine] = useState();\n  const [alertState, setAlertState] = useState({\n    open: false,\n    message: \"\",\n    severity: undefined\n  });\n  const [isActive, setIsActive] = useState(false);\n  const [endDate, setEndDate] = useState();\n  const [itemsRemaining, setItemsRemaining] = useState();\n  const [isWhitelistUser, setIsWhitelistUser] = useState(false);\n  const [isPresale, setIsPresale] = useState(false);\n  const [discountPrice, setDiscountPrice] = useState();\n  const rpcUrl = props.rpcHost;\n  const wallet = useWallet();\n  const anchorWallet = useMemo(() => {\n    if (!wallet || !wallet.publicKey || !wallet.signAllTransactions || !wallet.signTransaction) {\n      return;\n    }\n\n    return {\n      publicKey: wallet.publicKey,\n      signAllTransactions: wallet.signAllTransactions,\n      signTransaction: wallet.signTransaction\n    };\n  }, [wallet]);\n  const refreshCandyMachineState = useCallback(async () => {\n    if (!anchorWallet) {\n      return;\n    }\n\n    if (props.candyMachineId) {\n      try {\n        var _cndy$state$goLiveDat, _cndy$state$endSettin, _cndy$state$endSettin2;\n\n        const cndy = await getCandyMachineState(anchorWallet, props.candyMachineId, props.connection);\n        let active = (cndy === null || cndy === void 0 ? void 0 : (_cndy$state$goLiveDat = cndy.state.goLiveDate) === null || _cndy$state$goLiveDat === void 0 ? void 0 : _cndy$state$goLiveDat.toNumber()) < new Date().getTime() / 1000;\n        let presale = false; // whitelist mint?\n\n        if (cndy !== null && cndy !== void 0 && cndy.state.whitelistMintSettings) {\n          // is it a presale mint?\n          if (cndy.state.whitelistMintSettings.presale && (!cndy.state.goLiveDate || cndy.state.goLiveDate.toNumber() > new Date().getTime() / 1000)) {\n            presale = true;\n          } // is there a discount?\n\n\n          if (cndy.state.whitelistMintSettings.discountPrice) {\n            setDiscountPrice(cndy.state.whitelistMintSettings.discountPrice);\n          } else {\n            setDiscountPrice(undefined); // when presale=false and discountPrice=null, mint is restricted\n            // to whitelist users only\n\n            if (!cndy.state.whitelistMintSettings.presale) {\n              cndy.state.isWhitelistOnly = true;\n            }\n          } // retrieves the whitelist token\n\n\n          const mint = new anchor.web3.PublicKey(cndy.state.whitelistMintSettings.mint);\n          const token = (await getAtaForMint(mint, anchorWallet.publicKey))[0];\n\n          try {\n            const balance = await props.connection.getTokenAccountBalance(token);\n            let valid = parseInt(balance.value.amount) > 0; // only whitelist the user if the balance > 0\n\n            setIsWhitelistUser(valid);\n            active = presale && valid || active;\n          } catch (e) {\n            setIsWhitelistUser(false); // no whitelist user, no mint\n\n            if (cndy.state.isWhitelistOnly) {\n              active = false;\n            }\n\n            console.log(\"There was a problem fetching whitelist token balance\");\n            console.log(e);\n          }\n        } // datetime to stop the mint?\n\n\n        if (cndy !== null && cndy !== void 0 && (_cndy$state$endSettin = cndy.state.endSettings) !== null && _cndy$state$endSettin !== void 0 && _cndy$state$endSettin.endSettingType.date) {\n          setEndDate(toDate(cndy.state.endSettings.number));\n\n          if (cndy.state.endSettings.number.toNumber() < new Date().getTime() / 1000) {\n            active = false;\n          }\n        } // amount to stop the mint?\n\n\n        if (cndy !== null && cndy !== void 0 && (_cndy$state$endSettin2 = cndy.state.endSettings) !== null && _cndy$state$endSettin2 !== void 0 && _cndy$state$endSettin2.endSettingType.amount) {\n          let limit = Math.min(cndy.state.endSettings.number.toNumber(), cndy.state.itemsAvailable);\n\n          if (cndy.state.itemsRedeemed < limit) {\n            setItemsRemaining(limit - cndy.state.itemsRedeemed);\n          } else {\n            setItemsRemaining(0);\n            cndy.state.isSoldOut = true;\n          }\n        } else {\n          setItemsRemaining(cndy.state.itemsRemaining);\n        }\n\n        if (cndy.state.isSoldOut) {\n          active = false;\n        }\n\n        setIsActive(cndy.state.isActive = active);\n        setIsPresale(cndy.state.isPresale = presale);\n        setCandyMachine(cndy);\n      } catch (e) {\n        console.log(\"There was a problem fetching Candy Machine state\");\n        console.log(e);\n      }\n    }\n  }, [anchorWallet, props.candyMachineId, props.connection]);\n\n  const onMint = async () => {\n    try {\n      var _document$getElementB;\n\n      setIsUserMinting(true);\n      (_document$getElementB = document.getElementById(\"#identity\")) === null || _document$getElementB === void 0 ? void 0 : _document$getElementB.click();\n\n      if (wallet.connected && candyMachine !== null && candyMachine !== void 0 && candyMachine.program && wallet.publicKey) {\n        const mintTxId = (await mintOneToken(candyMachine, wallet.publicKey))[0];\n        let status = {\n          err: true\n        };\n\n        if (mintTxId) {\n          status = await awaitTransactionSignatureConfirmation(mintTxId, props.txTimeout, props.connection, true);\n        }\n\n        if (status && !status.err) {\n          // manual update since the refresh might not detect\n          // the change immediately\n          let remaining = itemsRemaining - 1;\n          setItemsRemaining(remaining);\n          setIsActive(candyMachine.state.isActive = remaining > 0);\n          candyMachine.state.isSoldOut = remaining === 0;\n          setAlertState({\n            open: true,\n            message: \"Congratulations! Mint succeeded!\",\n            severity: \"success\"\n          });\n        } else {\n          setAlertState({\n            open: true,\n            message: \"Mint failed! Please try again!\",\n            severity: \"error\"\n          });\n        }\n      }\n    } catch (error) {\n      let message = error.msg || \"Minting failed! Please try again!\";\n\n      if (!error.msg) {\n        if (!error.message) {\n          message = \"Transaction Timeout! Please try again.\";\n        } else if (error.message.indexOf(\"0x137\")) {\n          message = `SOLD OUT!`;\n        } else if (error.message.indexOf(\"0x135\")) {\n          message = `Insufficient funds to mint. Please fund your wallet.`;\n        }\n      } else {\n        if (error.code === 311) {\n          message = `SOLD OUT!`;\n          window.location.reload();\n        } else if (error.code === 312) {\n          message = `Minting period hasn't started yet.`;\n        }\n      }\n\n      setAlertState({\n        open: true,\n        message,\n        severity: \"error\"\n      }); // updates the candy machine state to reflect the lastest\n      // information on chain\n\n      refreshCandyMachineState();\n    } finally {\n      setIsUserMinting(false);\n    }\n  };\n\n  const toggleMintButton = () => {\n    let active = !isActive || isPresale;\n\n    if (active) {\n      if (candyMachine.state.isWhitelistOnly && !isWhitelistUser) {\n        active = false;\n      }\n\n      if (endDate && Date.now() >= endDate.getTime()) {\n        active = false;\n      }\n    }\n\n    if (isPresale && candyMachine.state.goLiveDate && candyMachine.state.goLiveDate.toNumber() <= new Date().getTime() / 1000) {\n      setIsPresale(candyMachine.state.isPresale = false);\n    }\n\n    setIsActive(candyMachine.state.isActive = active);\n  };\n\n  const getNft = async page => {\n    const res = await getAllNft(page);\n    setNft(res.mints);\n  };\n\n  useEffect(() => {\n    getNft(page);\n  }, [page, anchorWallet, props.candyMachineId, props.connection, refreshCandyMachineState]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Body, {\n      data: nft\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container col-sm-4 bg_white box\",\n      style: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\"\n      },\n      children: /*#__PURE__*/_jsxDEV(Pagination, {\n        count: totalNfts,\n        page: page,\n        onChange: (event, val) => setPage(val)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Home, \"ZV5pUnxxoqVS3z5jM1gU5fpYgH0=\", false, function () {\n  return [useWallet];\n});\n\n_c = Home;\n\nconst getCountdownDate = candyMachine => {\n  var _candyMachine$state$e;\n\n  if (candyMachine.state.isActive && (_candyMachine$state$e = candyMachine.state.endSettings) !== null && _candyMachine$state$e !== void 0 && _candyMachine$state$e.endSettingType.date) {\n    return toDate(candyMachine.state.endSettings.number);\n  }\n\n  return toDate(candyMachine.state.goLiveDate ? candyMachine.state.goLiveDate : candyMachine.state.isPresale ? new anchor.BN(new Date().getTime() / 1000) : undefined);\n};\n\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/Users/komalfulwar/Downloads/candy-machine-ui/src/Home.tsx"],"names":["useEffect","useMemo","useState","useCallback","anchor","styled","useWallet","WalletDialogButton","toDate","getAtaForMint","Header","Body","getAllNft","Pagination","totalNfts","ConnectButton","MintContainer","div","Home","props","page","setPage","isUserMinting","setIsUserMinting","nft","setNft","candyMachine","setCandyMachine","alertState","setAlertState","open","message","severity","undefined","isActive","setIsActive","endDate","setEndDate","itemsRemaining","setItemsRemaining","isWhitelistUser","setIsWhitelistUser","isPresale","setIsPresale","discountPrice","setDiscountPrice","rpcUrl","rpcHost","wallet","anchorWallet","publicKey","signAllTransactions","signTransaction","refreshCandyMachineState","candyMachineId","cndy","getCandyMachineState","connection","active","state","goLiveDate","toNumber","Date","getTime","presale","whitelistMintSettings","isWhitelistOnly","mint","web3","PublicKey","token","balance","getTokenAccountBalance","valid","parseInt","value","amount","e","console","log","endSettings","endSettingType","date","number","limit","Math","min","itemsAvailable","itemsRedeemed","isSoldOut","onMint","document","getElementById","click","connected","program","mintTxId","mintOneToken","status","err","awaitTransactionSignatureConfirmation","txTimeout","remaining","error","msg","indexOf","code","window","location","reload","toggleMintButton","now","getNft","res","mints","display","justifyContent","alignItems","event","val","getCountdownDate","BN"],"mappings":";;;AAAA,SAASA,SAAT,EAAoBC,OAApB,EAA6BC,QAA7B,EAAuCC,WAAvC,QAA0D,OAA1D;AACA,OAAO,KAAKC,MAAZ,MAAwB,uBAAxB;AAEA,OAAOC,MAAP,MAAmB,mBAAnB;AAEA,SAASC,SAAT,QAA0B,8BAA1B;AACA,SAASC,kBAAT,QAAmC,oCAAnC;AAEA,SAAqBC,MAArB,EAA6BC,aAA7B,QAAkD,SAAlD;AACA,OAAOC,MAAP,MAAmB,iBAAnB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,SAASC,SAAT,QAA0B,eAA1B;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AACA,SAASC,SAAT,QAA0B,mBAA1B;;;AAEA,MAAMC,aAAa,GAAGV,MAAM,CAACE,kBAAD,CAAqB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CATA;AAWA,MAAMS,aAAa,GAAGX,MAAM,CAACY,GAAI,EAAjC,C,CAAoC;;AASpC,MAAMC,IAAI,GAAIC,KAAD,IAAsB;AAAA;;AACjC,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBnB,QAAQ,CAAC,CAAD,CAAhC;AACA,QAAM,CAACoB,aAAD,EAAgBC,gBAAhB,IAAoCrB,QAAQ,CAAC,KAAD,CAAlD;AACA,QAAM,CAACsB,GAAD,EAAMC,MAAN,IAAgBvB,QAAQ,CAAC,EAAD,CAA9B;AACA,QAAM,CAACwB,YAAD,EAAeC,eAAf,IAAkCzB,QAAQ,EAAhD;AACA,QAAM,CAAC0B,UAAD,EAAaC,aAAb,IAA8B3B,QAAQ,CAAa;AACvD4B,IAAAA,IAAI,EAAE,KADiD;AAEvDC,IAAAA,OAAO,EAAE,EAF8C;AAGvDC,IAAAA,QAAQ,EAAEC;AAH6C,GAAb,CAA5C;AAKA,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BjC,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM,CAACkC,OAAD,EAAUC,UAAV,IAAwBnC,QAAQ,EAAtC;AACA,QAAM,CAACoC,cAAD,EAAiBC,iBAAjB,IAAsCrC,QAAQ,EAApD;AACA,QAAM,CAACsC,eAAD,EAAkBC,kBAAlB,IAAwCvC,QAAQ,CAAC,KAAD,CAAtD;AACA,QAAM,CAACwC,SAAD,EAAYC,YAAZ,IAA4BzC,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAAC0C,aAAD,EAAgBC,gBAAhB,IAAoC3C,QAAQ,EAAlD;AAEA,QAAM4C,MAAM,GAAG3B,KAAK,CAAC4B,OAArB;AACA,QAAMC,MAAM,GAAG1C,SAAS,EAAxB;AAEA,QAAM2C,YAAY,GAAGhD,OAAO,CAAC,MAAM;AACjC,QACE,CAAC+C,MAAD,IACA,CAACA,MAAM,CAACE,SADR,IAEA,CAACF,MAAM,CAACG,mBAFR,IAGA,CAACH,MAAM,CAACI,eAJV,EAKE;AACA;AACD;;AAED,WAAO;AACLF,MAAAA,SAAS,EAAEF,MAAM,CAACE,SADb;AAELC,MAAAA,mBAAmB,EAAEH,MAAM,CAACG,mBAFvB;AAGLC,MAAAA,eAAe,EAAEJ,MAAM,CAACI;AAHnB,KAAP;AAKD,GAf2B,EAezB,CAACJ,MAAD,CAfyB,CAA5B;AAiBA,QAAMK,wBAAwB,GAAGlD,WAAW,CAAC,YAAY;AACvD,QAAI,CAAC8C,YAAL,EAAmB;AACjB;AACD;;AAED,QAAI9B,KAAK,CAACmC,cAAV,EAA0B;AACxB,UAAI;AAAA;;AACF,cAAMC,IAAI,GAAG,MAAMC,oBAAoB,CACrCP,YADqC,EAErC9B,KAAK,CAACmC,cAF+B,EAGrCnC,KAAK,CAACsC,UAH+B,CAAvC;AAKA,YAAIC,MAAM,GACR,CAAAH,IAAI,SAAJ,IAAAA,IAAI,WAAJ,qCAAAA,IAAI,CAAEI,KAAN,CAAYC,UAAZ,gFAAwBC,QAAxB,MAAqC,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,IAD9D;AAEA,YAAIC,OAAO,GAAG,KAAd,CARE,CASF;;AACA,YAAIT,IAAJ,aAAIA,IAAJ,eAAIA,IAAI,CAAEI,KAAN,CAAYM,qBAAhB,EAAuC;AACrC;AACA,cACEV,IAAI,CAACI,KAAL,CAAWM,qBAAX,CAAiCD,OAAjC,KACC,CAACT,IAAI,CAACI,KAAL,CAAWC,UAAZ,IACCL,IAAI,CAACI,KAAL,CAAWC,UAAX,CAAsBC,QAAtB,KAAmC,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,IAF5D,CADF,EAIE;AACAC,YAAAA,OAAO,GAAG,IAAV;AACD,WARoC,CASrC;;;AACA,cAAIT,IAAI,CAACI,KAAL,CAAWM,qBAAX,CAAiCrB,aAArC,EAAoD;AAClDC,YAAAA,gBAAgB,CAACU,IAAI,CAACI,KAAL,CAAWM,qBAAX,CAAiCrB,aAAlC,CAAhB;AACD,WAFD,MAEO;AACLC,YAAAA,gBAAgB,CAACZ,SAAD,CAAhB,CADK,CAEL;AACA;;AACA,gBAAI,CAACsB,IAAI,CAACI,KAAL,CAAWM,qBAAX,CAAiCD,OAAtC,EAA+C;AAC7CT,cAAAA,IAAI,CAACI,KAAL,CAAWO,eAAX,GAA6B,IAA7B;AACD;AACF,WAnBoC,CAoBrC;;;AACA,gBAAMC,IAAI,GAAG,IAAI/D,MAAM,CAACgE,IAAP,CAAYC,SAAhB,CACXd,IAAI,CAACI,KAAL,CAAWM,qBAAX,CAAiCE,IADtB,CAAb;AAGA,gBAAMG,KAAK,GAAG,CAAC,MAAM7D,aAAa,CAAC0D,IAAD,EAAOlB,YAAY,CAACC,SAApB,CAApB,EAAoD,CAApD,CAAd;;AAEA,cAAI;AACF,kBAAMqB,OAAO,GAAG,MAAMpD,KAAK,CAACsC,UAAN,CAAiBe,sBAAjB,CACpBF,KADoB,CAAtB;AAGA,gBAAIG,KAAK,GAAGC,QAAQ,CAACH,OAAO,CAACI,KAAR,CAAcC,MAAf,CAAR,GAAiC,CAA7C,CAJE,CAKF;;AACAnC,YAAAA,kBAAkB,CAACgC,KAAD,CAAlB;AACAf,YAAAA,MAAM,GAAIM,OAAO,IAAIS,KAAZ,IAAsBf,MAA/B;AACD,WARD,CAQE,OAAOmB,CAAP,EAAU;AACVpC,YAAAA,kBAAkB,CAAC,KAAD,CAAlB,CADU,CAEV;;AACA,gBAAIc,IAAI,CAACI,KAAL,CAAWO,eAAf,EAAgC;AAC9BR,cAAAA,MAAM,GAAG,KAAT;AACD;;AACDoB,YAAAA,OAAO,CAACC,GAAR,CAAY,sDAAZ;AACAD,YAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACD;AACF,SArDC,CAsDF;;;AACA,YAAItB,IAAJ,aAAIA,IAAJ,wCAAIA,IAAI,CAAEI,KAAN,CAAYqB,WAAhB,kDAAI,sBAAyBC,cAAzB,CAAwCC,IAA5C,EAAkD;AAChD7C,UAAAA,UAAU,CAAC7B,MAAM,CAAC+C,IAAI,CAACI,KAAL,CAAWqB,WAAX,CAAuBG,MAAxB,CAAP,CAAV;;AACA,cACE5B,IAAI,CAACI,KAAL,CAAWqB,WAAX,CAAuBG,MAAvB,CAA8BtB,QAA9B,KACA,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,IAFzB,EAGE;AACAL,YAAAA,MAAM,GAAG,KAAT;AACD;AACF,SA/DC,CAgEF;;;AACA,YAAIH,IAAJ,aAAIA,IAAJ,yCAAIA,IAAI,CAAEI,KAAN,CAAYqB,WAAhB,mDAAI,uBAAyBC,cAAzB,CAAwCL,MAA5C,EAAoD;AAClD,cAAIQ,KAAK,GAAGC,IAAI,CAACC,GAAL,CACV/B,IAAI,CAACI,KAAL,CAAWqB,WAAX,CAAuBG,MAAvB,CAA8BtB,QAA9B,EADU,EAEVN,IAAI,CAACI,KAAL,CAAW4B,cAFD,CAAZ;;AAIA,cAAIhC,IAAI,CAACI,KAAL,CAAW6B,aAAX,GAA2BJ,KAA/B,EAAsC;AACpC7C,YAAAA,iBAAiB,CAAC6C,KAAK,GAAG7B,IAAI,CAACI,KAAL,CAAW6B,aAApB,CAAjB;AACD,WAFD,MAEO;AACLjD,YAAAA,iBAAiB,CAAC,CAAD,CAAjB;AACAgB,YAAAA,IAAI,CAACI,KAAL,CAAW8B,SAAX,GAAuB,IAAvB;AACD;AACF,SAXD,MAWO;AACLlD,UAAAA,iBAAiB,CAACgB,IAAI,CAACI,KAAL,CAAWrB,cAAZ,CAAjB;AACD;;AAED,YAAIiB,IAAI,CAACI,KAAL,CAAW8B,SAAf,EAA0B;AACxB/B,UAAAA,MAAM,GAAG,KAAT;AACD;;AAEDvB,QAAAA,WAAW,CAAEoB,IAAI,CAACI,KAAL,CAAWzB,QAAX,GAAsBwB,MAAxB,CAAX;AACAf,QAAAA,YAAY,CAAEY,IAAI,CAACI,KAAL,CAAWjB,SAAX,GAAuBsB,OAAzB,CAAZ;AACArC,QAAAA,eAAe,CAAC4B,IAAD,CAAf;AACD,OAvFD,CAuFE,OAAOsB,CAAP,EAAU;AACVC,QAAAA,OAAO,CAACC,GAAR,CAAY,kDAAZ;AACAD,QAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACD;AACF;AACF,GAlG2C,EAkGzC,CAAC5B,YAAD,EAAe9B,KAAK,CAACmC,cAArB,EAAqCnC,KAAK,CAACsC,UAA3C,CAlGyC,CAA5C;;AAoGA,QAAMiC,MAAM,GAAG,YAAY;AACzB,QAAI;AAAA;;AACFnE,MAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACA,+BAAAoE,QAAQ,CAACC,cAAT,CAAwB,WAAxB,iFAAsCC,KAAtC;;AACA,UAAI7C,MAAM,CAAC8C,SAAP,IAAoBpE,YAApB,aAAoBA,YAApB,eAAoBA,YAAY,CAAEqE,OAAlC,IAA6C/C,MAAM,CAACE,SAAxD,EAAmE;AACjE,cAAM8C,QAAQ,GAAG,CACf,MAAMC,YAAY,CAACvE,YAAD,EAAesB,MAAM,CAACE,SAAtB,CADH,EAEf,CAFe,CAAjB;AAIA,YAAIgD,MAAW,GAAG;AAAEC,UAAAA,GAAG,EAAE;AAAP,SAAlB;;AACA,YAAIH,QAAJ,EAAc;AACZE,UAAAA,MAAM,GAAG,MAAME,qCAAqC,CAClDJ,QADkD,EAElD7E,KAAK,CAACkF,SAF4C,EAGlDlF,KAAK,CAACsC,UAH4C,EAIlD,IAJkD,CAApD;AAMD;;AAED,YAAIyC,MAAM,IAAI,CAACA,MAAM,CAACC,GAAtB,EAA2B;AACzB;AACA;AACA,cAAIG,SAAS,GAAGhE,cAAc,GAAI,CAAlC;AACAC,UAAAA,iBAAiB,CAAC+D,SAAD,CAAjB;AACAnE,UAAAA,WAAW,CAAET,YAAY,CAACiC,KAAb,CAAmBzB,QAAnB,GAA8BoE,SAAS,GAAG,CAA5C,CAAX;AACA5E,UAAAA,YAAY,CAACiC,KAAb,CAAmB8B,SAAnB,GAA+Ba,SAAS,KAAK,CAA7C;AACAzE,UAAAA,aAAa,CAAC;AACZC,YAAAA,IAAI,EAAE,IADM;AAEZC,YAAAA,OAAO,EAAE,kCAFG;AAGZC,YAAAA,QAAQ,EAAE;AAHE,WAAD,CAAb;AAKD,SAZD,MAYO;AACLH,UAAAA,aAAa,CAAC;AACZC,YAAAA,IAAI,EAAE,IADM;AAEZC,YAAAA,OAAO,EAAE,gCAFG;AAGZC,YAAAA,QAAQ,EAAE;AAHE,WAAD,CAAb;AAKD;AACF;AACF,KAtCD,CAsCE,OAAOuE,KAAP,EAAmB;AACnB,UAAIxE,OAAO,GAAGwE,KAAK,CAACC,GAAN,IAAa,mCAA3B;;AACA,UAAI,CAACD,KAAK,CAACC,GAAX,EAAgB;AACd,YAAI,CAACD,KAAK,CAACxE,OAAX,EAAoB;AAClBA,UAAAA,OAAO,GAAG,wCAAV;AACD,SAFD,MAEO,IAAIwE,KAAK,CAACxE,OAAN,CAAc0E,OAAd,CAAsB,OAAtB,CAAJ,EAAoC;AACzC1E,UAAAA,OAAO,GAAI,WAAX;AACD,SAFM,MAEA,IAAIwE,KAAK,CAACxE,OAAN,CAAc0E,OAAd,CAAsB,OAAtB,CAAJ,EAAoC;AACzC1E,UAAAA,OAAO,GAAI,sDAAX;AACD;AACF,OARD,MAQO;AACL,YAAIwE,KAAK,CAACG,IAAN,KAAe,GAAnB,EAAwB;AACtB3E,UAAAA,OAAO,GAAI,WAAX;AACA4E,UAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB;AACD,SAHD,MAGO,IAAIN,KAAK,CAACG,IAAN,KAAe,GAAnB,EAAwB;AAC7B3E,UAAAA,OAAO,GAAI,oCAAX;AACD;AACF;;AAEDF,MAAAA,aAAa,CAAC;AACZC,QAAAA,IAAI,EAAE,IADM;AAEZC,QAAAA,OAFY;AAGZC,QAAAA,QAAQ,EAAE;AAHE,OAAD,CAAb,CAnBmB,CAwBnB;AACA;;AACAqB,MAAAA,wBAAwB;AACzB,KAjED,SAiEU;AACR9B,MAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACD;AACF,GArED;;AAuEA,QAAMuF,gBAAgB,GAAG,MAAM;AAC7B,QAAIpD,MAAM,GAAG,CAACxB,QAAD,IAAaQ,SAA1B;;AAEA,QAAIgB,MAAJ,EAAY;AACV,UAAIhC,YAAY,CAAEiC,KAAd,CAAoBO,eAApB,IAAuC,CAAC1B,eAA5C,EAA6D;AAC3DkB,QAAAA,MAAM,GAAG,KAAT;AACD;;AACD,UAAItB,OAAO,IAAI0B,IAAI,CAACiD,GAAL,MAAc3E,OAAO,CAAC2B,OAAR,EAA7B,EAAgD;AAC9CL,QAAAA,MAAM,GAAG,KAAT;AACD;AACF;;AAED,QACEhB,SAAS,IACThB,YAAY,CAAEiC,KAAd,CAAoBC,UADpB,IAEAlC,YAAY,CAAEiC,KAAd,CAAoBC,UAApB,CAA+BC,QAA/B,MAA6C,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,IAHtE,EAIE;AACApB,MAAAA,YAAY,CAAEjB,YAAY,CAAEiC,KAAd,CAAoBjB,SAApB,GAAgC,KAAlC,CAAZ;AACD;;AAEDP,IAAAA,WAAW,CAAET,YAAY,CAAEiC,KAAd,CAAoBzB,QAApB,GAA+BwB,MAAjC,CAAX;AACD,GArBD;;AAuBA,QAAMsD,MAAM,GAAG,MAAO5F,IAAP,IAAwB;AACrC,UAAM6F,GAAG,GAAG,MAAMrG,SAAS,CAACQ,IAAD,CAA3B;AACAK,IAAAA,MAAM,CAACwF,GAAG,CAACC,KAAL,CAAN;AACD,GAHD;;AAKAlH,EAAAA,SAAS,CAAC,MAAM;AACdgH,IAAAA,MAAM,CAAC5F,IAAD,CAAN;AACD,GAFQ,EAEN,CACDA,IADC,EAED6B,YAFC,EAGD9B,KAAK,CAACmC,cAHL,EAIDnC,KAAK,CAACsC,UAJL,EAKDJ,wBALC,CAFM,CAAT;AASA,sBACE;AAAA,4BACE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,YADF,eAEE,QAAC,IAAD;AAAM,MAAA,IAAI,EAAE7B;AAAZ;AAAA;AAAA;AAAA;AAAA,YAFF,eAIE;AACE,MAAA,SAAS,EAAC,iCADZ;AAEE,MAAA,KAAK,EAAE;AACL2F,QAAAA,OAAO,EAAE,MADJ;AAELC,QAAAA,cAAc,EAAE,QAFX;AAGLC,QAAAA,UAAU,EAAE;AAHP,OAFT;AAAA,6BAQE,QAAC,UAAD;AACE,QAAA,KAAK,EAAEvG,SADT;AAEE,QAAA,IAAI,EAAEM,IAFR;AAGE,QAAA,QAAQ,EAAE,CAACkG,KAAD,EAAQC,GAAR,KAAgBlG,OAAO,CAACkG,GAAD;AAHnC;AAAA;AAAA;AAAA;AAAA;AARF;AAAA;AAAA;AAAA;AAAA,YAJF,eAkBE;AAAA;AAAA;AAAA;AAAA,YAlBF;AAAA,kBADF;AAsBD,CA3QD;;GAAMrG,I;UAkBWZ,S;;;KAlBXY,I;;AA6QN,MAAMsG,gBAAgB,GACpB9F,YADuB,IAEF;AAAA;;AACrB,MACEA,YAAY,CAACiC,KAAb,CAAmBzB,QAAnB,6BACAR,YAAY,CAACiC,KAAb,CAAmBqB,WADnB,kDACA,sBAAgCC,cAAhC,CAA+CC,IAFjD,EAGE;AACA,WAAO1E,MAAM,CAACkB,YAAY,CAACiC,KAAb,CAAmBqB,WAAnB,CAA+BG,MAAhC,CAAb;AACD;;AAED,SAAO3E,MAAM,CACXkB,YAAY,CAACiC,KAAb,CAAmBC,UAAnB,GACIlC,YAAY,CAACiC,KAAb,CAAmBC,UADvB,GAEIlC,YAAY,CAACiC,KAAb,CAAmBjB,SAAnB,GACA,IAAItC,MAAM,CAACqH,EAAX,CAAc,IAAI3D,IAAJ,GAAWC,OAAX,KAAuB,IAArC,CADA,GAEA9B,SALO,CAAb;AAOD,CAjBD;;AAmBA,eAAef,IAAf","sourcesContent":["import { useEffect, useMemo, useState, useCallback } from \"react\";\nimport * as anchor from \"@project-serum/anchor\";\n\nimport styled from \"styled-components\";\n\nimport { useWallet } from \"@solana/wallet-adapter-react\";\nimport { WalletDialogButton } from \"@solana/wallet-adapter-material-ui\";\n\nimport { AlertState, toDate, getAtaForMint } from \"./utils\";\nimport Header from \"./header/Header\";\nimport Body from \"./body/body\";\nimport { getAllNft } from \"./service/api\";\nimport Pagination from \"@mui/material/Pagination\";\nimport { totalNfts } from \"./utils/constants\";\n\nconst ConnectButton = styled(WalletDialogButton)`\n  width: 100%;\n  height: 60px;\n  margin-top: 10px;\n  margin-bottom: 5px;\n  background: linear-gradient(180deg, #604ae5 0%, #813eee 100%);\n  color: white;\n  font-size: 16px;\n  font-weight: bold;\n`;\n\nconst MintContainer = styled.div``; // add your owns styles here\n\nexport interface HomeProps {\n  candyMachineId?: anchor.web3.PublicKey;\n  connection: anchor.web3.Connection;\n  txTimeout: number;\n  rpcHost: string;\n}\n\nconst Home = (props: HomeProps) => {\n  const [page, setPage] = useState(0);\n  const [isUserMinting, setIsUserMinting] = useState(false);\n  const [nft, setNft] = useState([]);\n  const [candyMachine, setCandyMachine] = useState<CandyMachineAccount>();\n  const [alertState, setAlertState] = useState<AlertState>({\n    open: false,\n    message: \"\",\n    severity: undefined,\n  });\n  const [isActive, setIsActive] = useState(false);\n  const [endDate, setEndDate] = useState<Date>();\n  const [itemsRemaining, setItemsRemaining] = useState<number>();\n  const [isWhitelistUser, setIsWhitelistUser] = useState(false);\n  const [isPresale, setIsPresale] = useState(false);\n  const [discountPrice, setDiscountPrice] = useState<anchor.BN>();\n\n  const rpcUrl = props.rpcHost;\n  const wallet = useWallet();\n\n  const anchorWallet = useMemo(() => {\n    if (\n      !wallet ||\n      !wallet.publicKey ||\n      !wallet.signAllTransactions ||\n      !wallet.signTransaction\n    ) {\n      return;\n    }\n\n    return {\n      publicKey: wallet.publicKey,\n      signAllTransactions: wallet.signAllTransactions,\n      signTransaction: wallet.signTransaction,\n    } as anchor.Wallet;\n  }, [wallet]);\n\n  const refreshCandyMachineState = useCallback(async () => {\n    if (!anchorWallet) {\n      return;\n    }\n\n    if (props.candyMachineId) {\n      try {\n        const cndy = await getCandyMachineState(\n          anchorWallet,\n          props.candyMachineId,\n          props.connection\n        );\n        let active =\n          cndy?.state.goLiveDate?.toNumber() < new Date().getTime() / 1000;\n        let presale = false;\n        // whitelist mint?\n        if (cndy?.state.whitelistMintSettings) {\n          // is it a presale mint?\n          if (\n            cndy.state.whitelistMintSettings.presale &&\n            (!cndy.state.goLiveDate ||\n              cndy.state.goLiveDate.toNumber() > new Date().getTime() / 1000)\n          ) {\n            presale = true;\n          }\n          // is there a discount?\n          if (cndy.state.whitelistMintSettings.discountPrice) {\n            setDiscountPrice(cndy.state.whitelistMintSettings.discountPrice);\n          } else {\n            setDiscountPrice(undefined);\n            // when presale=false and discountPrice=null, mint is restricted\n            // to whitelist users only\n            if (!cndy.state.whitelistMintSettings.presale) {\n              cndy.state.isWhitelistOnly = true;\n            }\n          }\n          // retrieves the whitelist token\n          const mint = new anchor.web3.PublicKey(\n            cndy.state.whitelistMintSettings.mint\n          );\n          const token = (await getAtaForMint(mint, anchorWallet.publicKey))[0];\n\n          try {\n            const balance = await props.connection.getTokenAccountBalance(\n              token\n            );\n            let valid = parseInt(balance.value.amount) > 0;\n            // only whitelist the user if the balance > 0\n            setIsWhitelistUser(valid);\n            active = (presale && valid) || active;\n          } catch (e) {\n            setIsWhitelistUser(false);\n            // no whitelist user, no mint\n            if (cndy.state.isWhitelistOnly) {\n              active = false;\n            }\n            console.log(\"There was a problem fetching whitelist token balance\");\n            console.log(e);\n          }\n        }\n        // datetime to stop the mint?\n        if (cndy?.state.endSettings?.endSettingType.date) {\n          setEndDate(toDate(cndy.state.endSettings.number));\n          if (\n            cndy.state.endSettings.number.toNumber() <\n            new Date().getTime() / 1000\n          ) {\n            active = false;\n          }\n        }\n        // amount to stop the mint?\n        if (cndy?.state.endSettings?.endSettingType.amount) {\n          let limit = Math.min(\n            cndy.state.endSettings.number.toNumber(),\n            cndy.state.itemsAvailable\n          );\n          if (cndy.state.itemsRedeemed < limit) {\n            setItemsRemaining(limit - cndy.state.itemsRedeemed);\n          } else {\n            setItemsRemaining(0);\n            cndy.state.isSoldOut = true;\n          }\n        } else {\n          setItemsRemaining(cndy.state.itemsRemaining);\n        }\n\n        if (cndy.state.isSoldOut) {\n          active = false;\n        }\n\n        setIsActive((cndy.state.isActive = active));\n        setIsPresale((cndy.state.isPresale = presale));\n        setCandyMachine(cndy);\n      } catch (e) {\n        console.log(\"There was a problem fetching Candy Machine state\");\n        console.log(e);\n      }\n    }\n  }, [anchorWallet, props.candyMachineId, props.connection]);\n\n  const onMint = async () => {\n    try {\n      setIsUserMinting(true);\n      document.getElementById(\"#identity\")?.click();\n      if (wallet.connected && candyMachine?.program && wallet.publicKey) {\n        const mintTxId = (\n          await mintOneToken(candyMachine, wallet.publicKey)\n        )[0];\n\n        let status: any = { err: true };\n        if (mintTxId) {\n          status = await awaitTransactionSignatureConfirmation(\n            mintTxId,\n            props.txTimeout,\n            props.connection,\n            true\n          );\n        }\n\n        if (status && !status.err) {\n          // manual update since the refresh might not detect\n          // the change immediately\n          let remaining = itemsRemaining! - 1;\n          setItemsRemaining(remaining);\n          setIsActive((candyMachine.state.isActive = remaining > 0));\n          candyMachine.state.isSoldOut = remaining === 0;\n          setAlertState({\n            open: true,\n            message: \"Congratulations! Mint succeeded!\",\n            severity: \"success\",\n          });\n        } else {\n          setAlertState({\n            open: true,\n            message: \"Mint failed! Please try again!\",\n            severity: \"error\",\n          });\n        }\n      }\n    } catch (error: any) {\n      let message = error.msg || \"Minting failed! Please try again!\";\n      if (!error.msg) {\n        if (!error.message) {\n          message = \"Transaction Timeout! Please try again.\";\n        } else if (error.message.indexOf(\"0x137\")) {\n          message = `SOLD OUT!`;\n        } else if (error.message.indexOf(\"0x135\")) {\n          message = `Insufficient funds to mint. Please fund your wallet.`;\n        }\n      } else {\n        if (error.code === 311) {\n          message = `SOLD OUT!`;\n          window.location.reload();\n        } else if (error.code === 312) {\n          message = `Minting period hasn't started yet.`;\n        }\n      }\n\n      setAlertState({\n        open: true,\n        message,\n        severity: \"error\",\n      });\n      // updates the candy machine state to reflect the lastest\n      // information on chain\n      refreshCandyMachineState();\n    } finally {\n      setIsUserMinting(false);\n    }\n  };\n\n  const toggleMintButton = () => {\n    let active = !isActive || isPresale;\n\n    if (active) {\n      if (candyMachine!.state.isWhitelistOnly && !isWhitelistUser) {\n        active = false;\n      }\n      if (endDate && Date.now() >= endDate.getTime()) {\n        active = false;\n      }\n    }\n\n    if (\n      isPresale &&\n      candyMachine!.state.goLiveDate &&\n      candyMachine!.state.goLiveDate.toNumber() <= new Date().getTime() / 1000\n    ) {\n      setIsPresale((candyMachine!.state.isPresale = false));\n    }\n\n    setIsActive((candyMachine!.state.isActive = active));\n  };\n\n  const getNft = async (page: number) => {\n    const res = await getAllNft(page);\n    setNft(res.mints);\n  };\n\n  useEffect(() => {\n    getNft(page);\n  }, [\n    page,\n    anchorWallet,\n    props.candyMachineId,\n    props.connection,\n    refreshCandyMachineState,\n  ]);\n  return (\n    <>\n      <Header />\n      <Body data={nft} />\n\n      <div\n        className=\"container col-sm-4 bg_white box\"\n        style={{\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n        }}\n      >\n        <Pagination\n          count={totalNfts}\n          page={page}\n          onChange={(event, val) => setPage(val)}\n        />\n      </div>\n      <br />\n    </>\n  );\n};\n\nconst getCountdownDate = (\n  candyMachine: CandyMachineAccount\n): Date | undefined => {\n  if (\n    candyMachine.state.isActive &&\n    candyMachine.state.endSettings?.endSettingType.date\n  ) {\n    return toDate(candyMachine.state.endSettings.number);\n  }\n\n  return toDate(\n    candyMachine.state.goLiveDate\n      ? candyMachine.state.goLiveDate\n      : candyMachine.state.isPresale\n      ? new anchor.BN(new Date().getTime() / 1000)\n      : undefined\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}