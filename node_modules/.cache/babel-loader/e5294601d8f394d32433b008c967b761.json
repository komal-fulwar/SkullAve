{"ast":null,"code":"import { sha256 } from \"js-sha256\";\nimport { IdlCoder } from \"./idl\";\nimport * as features from \"../utils/features\";\nexport class StateCoder {\n  constructor(idl) {\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n\n    this.layout = IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n\n  async encode(name, account) {\n    const buffer = Buffer.alloc(1000); // TODO: use a tighter buffer.\n\n    const len = this.layout.encode(account, buffer);\n    const disc = await stateDiscriminator(name);\n    const accData = buffer.slice(0, len);\n    return Buffer.concat([disc, accData]);\n  }\n\n  decode(ix) {\n    // Chop off discriminator.\n    const data = ix.slice(8);\n    return this.layout.decode(data);\n  }\n\n} // Calculates unique 8 byte discriminator prepended to all anchor state accounts.\n\nexport async function stateDiscriminator(name) {\n  let ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n  return Buffer.from(sha256.digest(`${ns}:${name}`)).slice(0, 8);\n}","map":{"version":3,"mappings":"AACA,SAASA,MAAT,QAAuB,WAAvB;AAEA,SAASC,QAAT,QAAyB,OAAzB;AACA,OAAO,KAAKC,QAAZ,MAA0B,mBAA1B;AAEA,OAAM,MAAOC,UAAP,CAAiB;AAGrBC,cAAmBC,GAAnB,EAA2B;AACzB,QAAIA,GAAG,CAACC,KAAJ,KAAcC,SAAlB,EAA6B;AAC3B,YAAM,IAAIC,KAAJ,CAAU,wBAAV,CAAN;AACD;;AACD,SAAKC,MAAL,GAAcR,QAAQ,CAACS,aAAT,CAAuBL,GAAG,CAACC,KAAJ,CAAUK,MAAjC,EAAyCN,GAAG,CAACO,KAA7C,CAAd;AACD;;AAEkB,QAANC,MAAM,CAAUC,IAAV,EAAwBC,OAAxB,EAAkC;AACnD,UAAMC,MAAM,GAAGC,MAAM,CAACC,KAAP,CAAa,IAAb,CAAf,CADmD,CAChB;;AACnC,UAAMC,GAAG,GAAG,KAAKV,MAAL,CAAYI,MAAZ,CAAmBE,OAAnB,EAA4BC,MAA5B,CAAZ;AAEA,UAAMI,IAAI,GAAG,MAAMC,kBAAkB,CAACP,IAAD,CAArC;AACA,UAAMQ,OAAO,GAAGN,MAAM,CAACO,KAAP,CAAa,CAAb,EAAgBJ,GAAhB,CAAhB;AAEA,WAAOF,MAAM,CAACO,MAAP,CAAc,CAACJ,IAAD,EAAOE,OAAP,CAAd,CAAP;AACD;;AAEMG,QAAM,CAAUC,EAAV,EAAoB;AAC/B;AACA,UAAMC,IAAI,GAAGD,EAAE,CAACH,KAAH,CAAS,CAAT,CAAb;AACA,WAAO,KAAKd,MAAL,CAAYgB,MAAZ,CAAmBE,IAAnB,CAAP;AACD;;AAxBoB,C,CA2BvB;;AACA,OAAO,eAAeN,kBAAf,CAAkCP,IAAlC,EAA8C;AACnD,MAAIc,EAAE,GAAG1B,QAAQ,CAAC2B,KAAT,CAAe,yBAAf,IAA4C,SAA5C,GAAwD,OAAjE;AACA,SAAOZ,MAAM,CAACa,IAAP,CAAY9B,MAAM,CAAC+B,MAAP,CAAc,GAAGH,EAAE,IAAId,IAAI,EAA3B,CAAZ,EAA4CS,KAA5C,CAAkD,CAAlD,EAAqD,CAArD,CAAP;AACD","names":["sha256","IdlCoder","features","StateCoder","constructor","idl","state","undefined","Error","layout","typeDefLayout","struct","types","encode","name","account","buffer","Buffer","alloc","len","disc","stateDiscriminator","accData","slice","concat","decode","ix","data","ns","isSet","from","digest"],"sourceRoot":"","sources":["../../../src/coder/state.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}