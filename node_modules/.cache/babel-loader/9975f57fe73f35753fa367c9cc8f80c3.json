{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction sanitize(params, defaults) {\n  const result = Object.assign(Object.assign({}, defaults), params);\n\n  if (typeof result.retries === 'undefined') {\n    result.retries = defaults.retries;\n  }\n\n  if (typeof result.retryDelay === 'undefined') {\n    result.retryDelay = defaults.retryDelay;\n  }\n\n  if (typeof result.retryOn === 'undefined') {\n    result.retryOn = defaults.retryOn;\n  }\n\n  return result;\n} // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\nfunction default_1(fetchFunc) {\n  let params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const defaults = sanitize(params, {\n    retries: 3,\n    retryDelay: 500,\n    retryOn: [419, 503, 504]\n  });\n  return function (input, init) {\n    const frp = sanitize({\n      retries: init === null || init === void 0 ? void 0 : init.retries,\n      retryDelay: init === null || init === void 0 ? void 0 : init.retryDelay,\n      retryOn: init === null || init === void 0 ? void 0 : init.retryOn\n    }, defaults);\n    const retryDelayFn = typeof frp.retryDelay === 'function' ? frp.retryDelay : () => frp.retryDelay;\n    const retryOnFn = typeof frp.retryOn === 'function' ? frp.retryOn : (attempt, retries, error, response) => (!!error || !response || frp.retryOn.indexOf(response.status) !== -1) && attempt < retries;\n    return new Promise(function (resolve, reject) {\n      const extendedFetch = function (attempt) {\n        fetchFunc(input, init).then(function (response) {\n          if (retryOnFn(attempt, frp.retries, null, response)) {\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            retry(attempt, null, response);\n          } else {\n            resolve(response);\n          }\n        }).catch(function (error) {\n          if (retryOnFn(attempt, frp.retries, error, null)) {\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            retry(attempt, error, null);\n          } else {\n            reject(error);\n          }\n        });\n      };\n\n      function retry(attempt, error, response) {\n        setTimeout(function () {\n          extendedFetch(++attempt);\n        }, retryDelayFn(attempt, error, response));\n      }\n\n      extendedFetch(0);\n    });\n  };\n}\n\nexports.default = default_1;","map":{"version":3,"mappings":"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","names":["sanitize","params","defaults","result","retries","retryDelay","retryOn","fetchFunc","input","init","frp","retryDelayFn","retryOnFn","attempt","error","response","indexOf","status","Promise","resolve","reject","extendedFetch","then","retry","catch","setTimeout","exports"],"sourceRoot":"","sources":["../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}