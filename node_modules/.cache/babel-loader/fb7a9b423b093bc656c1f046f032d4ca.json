{"ast":null,"code":"/**\n * \"Client\" wraps \"ws\" or a browser-implemented \"WebSocket\" library\n * according to the environment providing JSON RPC 2.0 support on top.\n * @module Client\n */\n\"use strict\"; // @ts-ignore\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _assertArgs = _interopRequireDefault(require(\"assert-args\"));\n\nvar _eventemitter = require(\"eventemitter3\");\n\nvar _circularJson = _interopRequireDefault(require(\"circular-json\"));\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar CommonClient = /*#__PURE__*/function (_EventEmitter) {\n  (0, _inherits2[\"default\"])(CommonClient, _EventEmitter);\n\n  var _super = _createSuper(CommonClient);\n  /**\n   * Instantiate a Client class.\n   * @constructor\n   * @param {webSocketFactory} webSocketFactory - factory method for WebSocket\n   * @param {String} address - url to a websocket server\n   * @param {Object} options - ws options object with reconnect parameters\n   * @param {Function} generate_request_id - custom generation request Id\n   * @return {CommonClient}\n   */\n\n\n  function CommonClient(webSocketFactory) {\n    var _this;\n\n    var address = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"ws://localhost:8080\";\n\n    var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n        _ref$autoconnect = _ref.autoconnect,\n        autoconnect = _ref$autoconnect === void 0 ? true : _ref$autoconnect,\n        _ref$reconnect = _ref.reconnect,\n        reconnect = _ref$reconnect === void 0 ? true : _ref$reconnect,\n        _ref$reconnect_interv = _ref.reconnect_interval,\n        reconnect_interval = _ref$reconnect_interv === void 0 ? 1000 : _ref$reconnect_interv,\n        _ref$max_reconnects = _ref.max_reconnects,\n        max_reconnects = _ref$max_reconnects === void 0 ? 5 : _ref$max_reconnects;\n\n    var generate_request_id = arguments.length > 3 ? arguments[3] : undefined;\n    (0, _classCallCheck2[\"default\"])(this, CommonClient);\n    _this = _super.call(this);\n    _this.webSocketFactory = webSocketFactory;\n    _this.queue = {};\n    _this.rpc_id = 0;\n    _this.address = address;\n    _this.options = arguments[2];\n    _this.autoconnect = autoconnect;\n    _this.ready = false;\n    _this.reconnect = reconnect;\n    _this.reconnect_interval = reconnect_interval;\n    _this.max_reconnects = max_reconnects;\n    _this.current_reconnects = 0;\n\n    _this.generate_request_id = generate_request_id || function () {\n      return ++_this.rpc_id;\n    };\n\n    if (_this.autoconnect) _this._connect(_this.address, _this.options);\n    return _this;\n  }\n  /**\n   * Connects to a defined server if not connected already.\n   * @method\n   * @return {Undefined}\n   */\n\n\n  (0, _createClass2[\"default\"])(CommonClient, [{\n    key: \"connect\",\n    value: function connect() {\n      if (this.socket) return;\n\n      this._connect(this.address, this.options);\n    }\n    /**\n     * Calls a registered RPC method on server.\n     * @method\n     * @param {String} method - RPC method name\n     * @param {Object|Array} params - optional method parameters\n     * @param {Number} timeout - RPC reply timeout value\n     * @param {Object} ws_opts - options passed to ws\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"call\",\n    value: function call(method, params, timeout, ws_opts) {\n      var _this2 = this;\n\n      (0, _assertArgs[\"default\"])(arguments, {\n        \"method\": \"string\",\n        \"[params]\": [\"object\", Array],\n        \"[timeout]\": \"number\",\n        \"[ws_opts]\": \"object\"\n      });\n\n      if (!ws_opts && \"object\" === (0, _typeof2[\"default\"])(timeout)) {\n        ws_opts = timeout;\n        timeout = null;\n      }\n\n      return new Promise(function (resolve, reject) {\n        if (!_this2.ready) return reject(new Error(\"socket not ready\"));\n\n        var rpc_id = _this2.generate_request_id(method, params);\n\n        var message = {\n          jsonrpc: \"2.0\",\n          method: method,\n          params: params || null,\n          id: rpc_id\n        };\n\n        _this2.socket.send(JSON.stringify(message), ws_opts, function (error) {\n          if (error) return reject(error);\n          _this2.queue[rpc_id] = {\n            promise: [resolve, reject]\n          };\n\n          if (timeout) {\n            _this2.queue[rpc_id].timeout = setTimeout(function () {\n              _this2.queue[rpc_id] = null;\n              reject(new Error(\"reply timeout\"));\n            }, timeout);\n          }\n        });\n      });\n    }\n    /**\n     * Logins with the other side of the connection.\n     * @method\n     * @param {Object} params - Login credentials object\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"login\",\n    value: function () {\n      var _login = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(params) {\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.call(\"rpc.login\", params);\n\n              case 2:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function login(_x) {\n        return _login.apply(this, arguments);\n      }\n\n      return login;\n    }()\n    /**\n     * Fetches a list of client's methods registered on server.\n     * @method\n     * @return {Array}\n     */\n\n  }, {\n    key: \"listMethods\",\n    value: function () {\n      var _listMethods = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.call(\"__listMethods\");\n\n              case 2:\n                return _context2.abrupt(\"return\", _context2.sent);\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function listMethods() {\n        return _listMethods.apply(this, arguments);\n      }\n\n      return listMethods;\n    }()\n    /**\n     * Sends a JSON-RPC 2.0 notification to server.\n     * @method\n     * @param {String} method - RPC method name\n     * @param {Object} params - optional method parameters\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"notify\",\n    value: function notify(method, params) {\n      var _this3 = this;\n\n      (0, _assertArgs[\"default\"])(arguments, {\n        \"method\": \"string\",\n        \"[params]\": [\"object\", Array]\n      });\n      return new Promise(function (resolve, reject) {\n        if (!_this3.ready) return reject(new Error(\"socket not ready\"));\n        var message = {\n          jsonrpc: \"2.0\",\n          method: method,\n          params: params || null\n        };\n\n        _this3.socket.send(JSON.stringify(message), function (error) {\n          if (error) return reject(error);\n          resolve();\n        });\n      });\n    }\n    /**\n     * Subscribes for a defined event.\n     * @method\n     * @param {String|Array} event - event name\n     * @return {Undefined}\n     * @throws {Error}\n     */\n\n  }, {\n    key: \"subscribe\",\n    value: function () {\n      var _subscribe = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(event) {\n        var result,\n            _args3 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                (0, _assertArgs[\"default\"])(_args3, {\n                  event: [\"string\", Array]\n                });\n                if (typeof event === \"string\") event = [event];\n                _context3.next = 4;\n                return this.call(\"rpc.on\", event);\n\n              case 4:\n                result = _context3.sent;\n\n                if (!(typeof event === \"string\" && result[event] !== \"ok\")) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                throw new Error(\"Failed subscribing to an event '\" + event + \"' with: \" + result[event]);\n\n              case 7:\n                return _context3.abrupt(\"return\", result);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function subscribe(_x2) {\n        return _subscribe.apply(this, arguments);\n      }\n\n      return subscribe;\n    }()\n    /**\n     * Unsubscribes from a defined event.\n     * @method\n     * @param {String|Array} event - event name\n     * @return {Undefined}\n     * @throws {Error}\n     */\n\n  }, {\n    key: \"unsubscribe\",\n    value: function () {\n      var _unsubscribe = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(event) {\n        var result,\n            _args4 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                (0, _assertArgs[\"default\"])(_args4, {\n                  event: [\"string\", Array]\n                });\n                if (typeof event === \"string\") event = [event];\n                _context4.next = 4;\n                return this.call(\"rpc.off\", event);\n\n              case 4:\n                result = _context4.sent;\n\n                if (!(typeof event === \"string\" && result[event] !== \"ok\")) {\n                  _context4.next = 7;\n                  break;\n                }\n\n                throw new Error(\"Failed unsubscribing from an event with: \" + result);\n\n              case 7:\n                return _context4.abrupt(\"return\", result);\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function unsubscribe(_x3) {\n        return _unsubscribe.apply(this, arguments);\n      }\n\n      return unsubscribe;\n    }()\n    /**\n     * Closes a WebSocket connection gracefully.\n     * @method\n     * @param {Number} code - socket close code\n     * @param {String} data - optional data to be sent before closing\n     * @return {Undefined}\n     */\n\n  }, {\n    key: \"close\",\n    value: function close(code, data) {\n      this.socket.close(code || 1000, data);\n    }\n    /**\n     * Connection/Message handler.\n     * @method\n     * @private\n     * @param {String} address - WebSocket API address\n     * @param {Object} options - ws options object\n     * @return {Undefined}\n     */\n\n  }, {\n    key: \"_connect\",\n    value: function _connect(address, options) {\n      var _this4 = this;\n\n      this.socket = this.webSocketFactory(address, options);\n      this.socket.addEventListener(\"open\", function () {\n        _this4.ready = true;\n\n        _this4.emit(\"open\");\n\n        _this4.current_reconnects = 0;\n      });\n      this.socket.addEventListener(\"message\", function (_ref2) {\n        var message = _ref2.data;\n        if (message instanceof ArrayBuffer) message = Buffer.from(message).toString();\n\n        try {\n          message = _circularJson[\"default\"].parse(message);\n        } catch (error) {\n          return;\n        } // check if any listeners are attached and forward event\n\n\n        if (message.notification && _this4.listeners(message.notification).length) {\n          if (!Object.keys(message.params).length) return _this4.emit(message.notification);\n          var args = [message.notification];\n          if (message.params.constructor === Object) args.push(message.params);else // using for-loop instead of unshift/spread because performance is better\n            for (var i = 0; i < message.params.length; i++) {\n              args.push(message.params[i]);\n            }\n          return _this4.emit.apply(_this4, args);\n        }\n\n        if (!_this4.queue[message.id]) {\n          // general JSON RPC 2.0 events\n          if (message.method && message.params) return _this4.emit(message.method, message.params);else return;\n        }\n\n        if (_this4.queue[message.id].timeout) clearTimeout(_this4.queue[message.id].timeout);\n        if (message.error) _this4.queue[message.id].promise[1](message.error);else _this4.queue[message.id].promise[0](message.result);\n        _this4.queue[message.id] = null;\n      });\n      this.socket.addEventListener(\"error\", function (error) {\n        return _this4.emit(\"error\", error);\n      });\n      this.socket.addEventListener(\"close\", function (_ref3) {\n        var code = _ref3.code,\n            reason = _ref3.reason;\n        if (_this4.ready) _this4.emit(\"close\", code, reason);\n        _this4.ready = false;\n        if (code === 1000) return;\n        _this4.current_reconnects++;\n        if (_this4.reconnect && (_this4.max_reconnects > _this4.current_reconnects || _this4.max_reconnects === 0)) setTimeout(function () {\n          return _this4._connect(address, options);\n        }, _this4.reconnect_interval);\n      });\n    }\n  }]);\n  return CommonClient;\n}(_eventemitter.EventEmitter);\n\nexports[\"default\"] = CommonClient;","map":{"version":3,"sources":["/Users/komalfulwar/Downloads/candy-machine-ui/node_modules/rpc-websockets/dist/lib/client.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_regenerator","_asyncToGenerator2","_typeof2","_classCallCheck2","_createClass2","_inherits2","_possibleConstructorReturn2","_getPrototypeOf2","_assertArgs","_eventemitter","_circularJson","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Date","prototype","toString","call","e","CommonClient","_EventEmitter","_super","webSocketFactory","_this","address","length","undefined","_ref","_ref$autoconnect","autoconnect","_ref$reconnect","reconnect","_ref$reconnect_interv","reconnect_interval","_ref$max_reconnects","max_reconnects","generate_request_id","queue","rpc_id","options","ready","current_reconnects","_connect","key","connect","socket","method","params","timeout","ws_opts","_this2","Array","Promise","resolve","reject","Error","message","jsonrpc","id","send","JSON","stringify","error","promise","setTimeout","_login","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","sent","stop","login","_x","_listMethods","_callee2","_callee2$","_context2","listMethods","notify","_this3","_subscribe","_callee3","event","_args3","_callee3$","_context3","subscribe","_x2","_unsubscribe","_callee4","_args4","_callee4$","_context4","unsubscribe","_x3","close","code","data","_this4","addEventListener","emit","_ref2","ArrayBuffer","Buffer","from","parse","notification","listeners","keys","args","push","i","clearTimeout","_ref3","reason","EventEmitter"],"mappings":"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","sourcesContent":["/**\n * \"Client\" wraps \"ws\" or a browser-implemented \"WebSocket\" library\n * according to the environment providing JSON RPC 2.0 support on top.\n * @module Client\n */\n\"use strict\"; // @ts-ignore\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _assertArgs = _interopRequireDefault(require(\"assert-args\"));\n\nvar _eventemitter = require(\"eventemitter3\");\n\nvar _circularJson = _interopRequireDefault(require(\"circular-json\"));\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2[\"default\"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2[\"default\"])(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nvar CommonClient = /*#__PURE__*/function (_EventEmitter) {\n  (0, _inherits2[\"default\"])(CommonClient, _EventEmitter);\n\n  var _super = _createSuper(CommonClient);\n\n  /**\n   * Instantiate a Client class.\n   * @constructor\n   * @param {webSocketFactory} webSocketFactory - factory method for WebSocket\n   * @param {String} address - url to a websocket server\n   * @param {Object} options - ws options object with reconnect parameters\n   * @param {Function} generate_request_id - custom generation request Id\n   * @return {CommonClient}\n   */\n  function CommonClient(webSocketFactory) {\n    var _this;\n\n    var address = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"ws://localhost:8080\";\n\n    var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n        _ref$autoconnect = _ref.autoconnect,\n        autoconnect = _ref$autoconnect === void 0 ? true : _ref$autoconnect,\n        _ref$reconnect = _ref.reconnect,\n        reconnect = _ref$reconnect === void 0 ? true : _ref$reconnect,\n        _ref$reconnect_interv = _ref.reconnect_interval,\n        reconnect_interval = _ref$reconnect_interv === void 0 ? 1000 : _ref$reconnect_interv,\n        _ref$max_reconnects = _ref.max_reconnects,\n        max_reconnects = _ref$max_reconnects === void 0 ? 5 : _ref$max_reconnects;\n\n    var generate_request_id = arguments.length > 3 ? arguments[3] : undefined;\n    (0, _classCallCheck2[\"default\"])(this, CommonClient);\n    _this = _super.call(this);\n    _this.webSocketFactory = webSocketFactory;\n    _this.queue = {};\n    _this.rpc_id = 0;\n    _this.address = address;\n    _this.options = arguments[2];\n    _this.autoconnect = autoconnect;\n    _this.ready = false;\n    _this.reconnect = reconnect;\n    _this.reconnect_interval = reconnect_interval;\n    _this.max_reconnects = max_reconnects;\n    _this.current_reconnects = 0;\n\n    _this.generate_request_id = generate_request_id || function () {\n      return ++_this.rpc_id;\n    };\n\n    if (_this.autoconnect) _this._connect(_this.address, _this.options);\n    return _this;\n  }\n  /**\n   * Connects to a defined server if not connected already.\n   * @method\n   * @return {Undefined}\n   */\n\n\n  (0, _createClass2[\"default\"])(CommonClient, [{\n    key: \"connect\",\n    value: function connect() {\n      if (this.socket) return;\n\n      this._connect(this.address, this.options);\n    }\n    /**\n     * Calls a registered RPC method on server.\n     * @method\n     * @param {String} method - RPC method name\n     * @param {Object|Array} params - optional method parameters\n     * @param {Number} timeout - RPC reply timeout value\n     * @param {Object} ws_opts - options passed to ws\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"call\",\n    value: function call(method, params, timeout, ws_opts) {\n      var _this2 = this;\n\n      (0, _assertArgs[\"default\"])(arguments, {\n        \"method\": \"string\",\n        \"[params]\": [\"object\", Array],\n        \"[timeout]\": \"number\",\n        \"[ws_opts]\": \"object\"\n      });\n\n      if (!ws_opts && \"object\" === (0, _typeof2[\"default\"])(timeout)) {\n        ws_opts = timeout;\n        timeout = null;\n      }\n\n      return new Promise(function (resolve, reject) {\n        if (!_this2.ready) return reject(new Error(\"socket not ready\"));\n\n        var rpc_id = _this2.generate_request_id(method, params);\n\n        var message = {\n          jsonrpc: \"2.0\",\n          method: method,\n          params: params || null,\n          id: rpc_id\n        };\n\n        _this2.socket.send(JSON.stringify(message), ws_opts, function (error) {\n          if (error) return reject(error);\n          _this2.queue[rpc_id] = {\n            promise: [resolve, reject]\n          };\n\n          if (timeout) {\n            _this2.queue[rpc_id].timeout = setTimeout(function () {\n              _this2.queue[rpc_id] = null;\n              reject(new Error(\"reply timeout\"));\n            }, timeout);\n          }\n        });\n      });\n    }\n    /**\n     * Logins with the other side of the connection.\n     * @method\n     * @param {Object} params - Login credentials object\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"login\",\n    value: function () {\n      var _login = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(params) {\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.call(\"rpc.login\", params);\n\n              case 2:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function login(_x) {\n        return _login.apply(this, arguments);\n      }\n\n      return login;\n    }()\n    /**\n     * Fetches a list of client's methods registered on server.\n     * @method\n     * @return {Array}\n     */\n\n  }, {\n    key: \"listMethods\",\n    value: function () {\n      var _listMethods = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.call(\"__listMethods\");\n\n              case 2:\n                return _context2.abrupt(\"return\", _context2.sent);\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function listMethods() {\n        return _listMethods.apply(this, arguments);\n      }\n\n      return listMethods;\n    }()\n    /**\n     * Sends a JSON-RPC 2.0 notification to server.\n     * @method\n     * @param {String} method - RPC method name\n     * @param {Object} params - optional method parameters\n     * @return {Promise}\n     */\n\n  }, {\n    key: \"notify\",\n    value: function notify(method, params) {\n      var _this3 = this;\n\n      (0, _assertArgs[\"default\"])(arguments, {\n        \"method\": \"string\",\n        \"[params]\": [\"object\", Array]\n      });\n      return new Promise(function (resolve, reject) {\n        if (!_this3.ready) return reject(new Error(\"socket not ready\"));\n        var message = {\n          jsonrpc: \"2.0\",\n          method: method,\n          params: params || null\n        };\n\n        _this3.socket.send(JSON.stringify(message), function (error) {\n          if (error) return reject(error);\n          resolve();\n        });\n      });\n    }\n    /**\n     * Subscribes for a defined event.\n     * @method\n     * @param {String|Array} event - event name\n     * @return {Undefined}\n     * @throws {Error}\n     */\n\n  }, {\n    key: \"subscribe\",\n    value: function () {\n      var _subscribe = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(event) {\n        var result,\n            _args3 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                (0, _assertArgs[\"default\"])(_args3, {\n                  event: [\"string\", Array]\n                });\n                if (typeof event === \"string\") event = [event];\n                _context3.next = 4;\n                return this.call(\"rpc.on\", event);\n\n              case 4:\n                result = _context3.sent;\n\n                if (!(typeof event === \"string\" && result[event] !== \"ok\")) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                throw new Error(\"Failed subscribing to an event '\" + event + \"' with: \" + result[event]);\n\n              case 7:\n                return _context3.abrupt(\"return\", result);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function subscribe(_x2) {\n        return _subscribe.apply(this, arguments);\n      }\n\n      return subscribe;\n    }()\n    /**\n     * Unsubscribes from a defined event.\n     * @method\n     * @param {String|Array} event - event name\n     * @return {Undefined}\n     * @throws {Error}\n     */\n\n  }, {\n    key: \"unsubscribe\",\n    value: function () {\n      var _unsubscribe = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(event) {\n        var result,\n            _args4 = arguments;\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                (0, _assertArgs[\"default\"])(_args4, {\n                  event: [\"string\", Array]\n                });\n                if (typeof event === \"string\") event = [event];\n                _context4.next = 4;\n                return this.call(\"rpc.off\", event);\n\n              case 4:\n                result = _context4.sent;\n\n                if (!(typeof event === \"string\" && result[event] !== \"ok\")) {\n                  _context4.next = 7;\n                  break;\n                }\n\n                throw new Error(\"Failed unsubscribing from an event with: \" + result);\n\n              case 7:\n                return _context4.abrupt(\"return\", result);\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function unsubscribe(_x3) {\n        return _unsubscribe.apply(this, arguments);\n      }\n\n      return unsubscribe;\n    }()\n    /**\n     * Closes a WebSocket connection gracefully.\n     * @method\n     * @param {Number} code - socket close code\n     * @param {String} data - optional data to be sent before closing\n     * @return {Undefined}\n     */\n\n  }, {\n    key: \"close\",\n    value: function close(code, data) {\n      this.socket.close(code || 1000, data);\n    }\n    /**\n     * Connection/Message handler.\n     * @method\n     * @private\n     * @param {String} address - WebSocket API address\n     * @param {Object} options - ws options object\n     * @return {Undefined}\n     */\n\n  }, {\n    key: \"_connect\",\n    value: function _connect(address, options) {\n      var _this4 = this;\n\n      this.socket = this.webSocketFactory(address, options);\n      this.socket.addEventListener(\"open\", function () {\n        _this4.ready = true;\n\n        _this4.emit(\"open\");\n\n        _this4.current_reconnects = 0;\n      });\n      this.socket.addEventListener(\"message\", function (_ref2) {\n        var message = _ref2.data;\n        if (message instanceof ArrayBuffer) message = Buffer.from(message).toString();\n\n        try {\n          message = _circularJson[\"default\"].parse(message);\n        } catch (error) {\n          return;\n        } // check if any listeners are attached and forward event\n\n\n        if (message.notification && _this4.listeners(message.notification).length) {\n          if (!Object.keys(message.params).length) return _this4.emit(message.notification);\n          var args = [message.notification];\n          if (message.params.constructor === Object) args.push(message.params);else // using for-loop instead of unshift/spread because performance is better\n            for (var i = 0; i < message.params.length; i++) {\n              args.push(message.params[i]);\n            }\n          return _this4.emit.apply(_this4, args);\n        }\n\n        if (!_this4.queue[message.id]) {\n          // general JSON RPC 2.0 events\n          if (message.method && message.params) return _this4.emit(message.method, message.params);else return;\n        }\n\n        if (_this4.queue[message.id].timeout) clearTimeout(_this4.queue[message.id].timeout);\n        if (message.error) _this4.queue[message.id].promise[1](message.error);else _this4.queue[message.id].promise[0](message.result);\n        _this4.queue[message.id] = null;\n      });\n      this.socket.addEventListener(\"error\", function (error) {\n        return _this4.emit(\"error\", error);\n      });\n      this.socket.addEventListener(\"close\", function (_ref3) {\n        var code = _ref3.code,\n            reason = _ref3.reason;\n        if (_this4.ready) _this4.emit(\"close\", code, reason);\n        _this4.ready = false;\n        if (code === 1000) return;\n        _this4.current_reconnects++;\n        if (_this4.reconnect && (_this4.max_reconnects > _this4.current_reconnects || _this4.max_reconnects === 0)) setTimeout(function () {\n          return _this4._connect(address, options);\n        }, _this4.reconnect_interval);\n      });\n    }\n  }]);\n  return CommonClient;\n}(_eventemitter.EventEmitter);\n\nexports[\"default\"] = CommonClient;"]},"metadata":{},"sourceType":"script"}