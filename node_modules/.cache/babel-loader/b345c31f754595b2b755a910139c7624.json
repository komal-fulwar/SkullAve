{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { BaseMessageSignerWalletAdapter, pollUntilReady, WalletConnectionError, WalletDisconnectionError, WalletError, WalletNotConnectedError, WalletNotFoundError, WalletPublicKeyError, WalletSignTransactionError } from '@solana/wallet-adapter-base';\nimport { PublicKey } from '@solana/web3.js';\nimport bs58 from 'bs58';\nexport class SlopeWalletAdapter extends BaseMessageSignerWalletAdapter {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this._connecting = false;\n    this._wallet = null;\n    this._publicKey = null;\n    if (!this.ready) pollUntilReady(this, config.pollInterval || 1000, config.pollCount || 3);\n  }\n\n  get publicKey() {\n    return this._publicKey;\n  }\n\n  get ready() {\n    return typeof window !== 'undefined' && !!window.Slope;\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get connected() {\n    return !!this._publicKey;\n  }\n\n  connect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        if (this.connected || this.connecting) return;\n        this._connecting = true;\n        if (!window.Slope) throw new WalletNotFoundError();\n        const wallet = new window.Slope();\n        let account;\n\n        try {\n          const {\n            data\n          } = yield wallet.connect();\n          if (!data.publicKey) throw new WalletConnectionError();\n          account = data.publicKey;\n        } catch (error) {\n          if (error instanceof WalletError) throw error;\n          throw new WalletConnectionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        let publicKey;\n\n        try {\n          publicKey = new PublicKey(account);\n        } catch (error) {\n          throw new WalletPublicKeyError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        this._wallet = wallet;\n        this._publicKey = publicKey;\n        this.emit('connect');\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const wallet = this._wallet;\n\n      if (wallet) {\n        this._wallet = null;\n        this._publicKey = null;\n\n        try {\n          const {\n            msg\n          } = yield wallet.disconnect();\n          if (msg !== 'ok') throw new WalletDisconnectionError(msg);\n        } catch (error) {\n          if (!(error instanceof WalletError)) {\n            // eslint-disable-next-line no-ex-assign\n            error = new WalletDisconnectionError(error === null || error === void 0 ? void 0 : error.message, error);\n          }\n\n          this.emit('error', error);\n        }\n      }\n\n      this.emit('disconnect');\n    });\n  }\n\n  signTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new WalletNotConnectedError();\n\n        try {\n          const message = bs58.encode(transaction.serializeMessage());\n          const {\n            msg,\n            data\n          } = yield wallet.signTransaction(message);\n          if (!data.publicKey || !data.signature) throw new WalletSignTransactionError(msg);\n          const publicKey = new PublicKey(data.publicKey);\n          const signature = bs58.decode(data.signature);\n          transaction.addSignature(publicKey, signature);\n          return transaction;\n        } catch (error) {\n          if (error instanceof WalletError) throw error;\n          throw new WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n  signAllTransactions(transactions) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new WalletNotConnectedError();\n\n        try {\n          const messages = transactions.map(transaction => bs58.encode(transaction.serializeMessage()));\n          const {\n            msg,\n            data\n          } = yield wallet.signAllTransactions(messages);\n          const length = transactions.length;\n          if (!data.publicKey || ((_a = data.signatures) === null || _a === void 0 ? void 0 : _a.length) !== length) throw new WalletSignTransactionError(msg);\n          const publicKey = new PublicKey(data.publicKey);\n\n          for (let i = 0; i < length; i++) {\n            transactions[i].addSignature(publicKey, bs58.decode(data.signatures[i]));\n          }\n\n          return transactions;\n        } catch (error) {\n          if (error instanceof WalletError) throw error;\n          throw new WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n  signMessage(message) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new WalletNotConnectedError();\n\n        try {\n          const response = yield wallet.signMessage(message);\n          return bs58.decode(response.data.signature);\n        } catch (error) {\n          throw new WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n}","map":{"version":3,"mappings":"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","names":["BaseMessageSignerWalletAdapter","pollUntilReady","WalletConnectionError","WalletDisconnectionError","WalletError","WalletNotConnectedError","WalletNotFoundError","WalletPublicKeyError","WalletSignTransactionError","PublicKey","bs58","SlopeWalletAdapter","constructor","config","_connecting","_wallet","_publicKey","ready","pollInterval","pollCount","publicKey","window","Slope","connecting","connected","connect","wallet","account","data","error","message","emit","disconnect","msg","signTransaction","transaction","encode","serializeMessage","signature","decode","addSignature","signAllTransactions","transactions","messages","map","length","signatures","_a","i","signMessage","response"],"sourceRoot":"","sources":["../src/adapter.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}