{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport Wallet from '@project-serum/sol-wallet-adapter';\nimport { BaseMessageSignerWalletAdapter, pollUntilReady, WalletAdapterNetwork, WalletConnectionError, WalletDisconnectedError, WalletDisconnectionError, WalletError, WalletNotConnectedError, WalletNotFoundError, WalletSignMessageError, WalletSignTransactionError, WalletTimeoutError, WalletWindowBlockedError, WalletWindowClosedError } from '@solana/wallet-adapter-base';\nexport class SolletWalletAdapter extends BaseMessageSignerWalletAdapter {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n\n    this._disconnected = () => {\n      const wallet = this._wallet;\n\n      if (wallet) {\n        wallet.off('disconnect', this._disconnected);\n        this._wallet = null;\n        this.emit('error', new WalletDisconnectedError());\n        this.emit('disconnect');\n      }\n    };\n\n    this._provider = config.provider || (typeof window === 'undefined' ? undefined : window.sollet);\n    this._network = config.network || WalletAdapterNetwork.Mainnet;\n    this._connecting = false;\n    this._wallet = null;\n    if (!this.ready) pollUntilReady(this, config.pollInterval || 1000, config.pollCount || 3);\n  }\n\n  get publicKey() {\n    var _a;\n\n    return ((_a = this._wallet) === null || _a === void 0 ? void 0 : _a.publicKey) || null;\n  }\n\n  get ready() {\n    var _a;\n\n    return typeof this._provider === 'string' || typeof window !== 'undefined' && typeof ((_a = window.sollet) === null || _a === void 0 ? void 0 : _a.postMessage) === 'function';\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get connected() {\n    var _a;\n\n    return !!((_a = this._wallet) === null || _a === void 0 ? void 0 : _a.connected);\n  }\n\n  connect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        if (this.connected || this.connecting) return;\n        this._connecting = true;\n        const provider = this._provider || typeof window !== 'undefined' && window.sollet;\n        if (!provider) throw new WalletNotFoundError();\n        let wallet;\n\n        try {\n          wallet = new Wallet(provider, this._network); // HACK: sol-wallet-adapter doesn't reject or emit an event if the popup or extension is closed or blocked\n\n          const handleDisconnect = wallet.handleDisconnect;\n          let timeout;\n          let interval;\n\n          try {\n            yield new Promise((resolve, reject) => {\n              const connect = () => {\n                if (timeout) clearTimeout(timeout);\n                wallet.off('connect', connect);\n                resolve();\n              };\n\n              wallet.handleDisconnect = function () {\n                wallet.off('connect', connect);\n                reject(new WalletWindowClosedError());\n\n                for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n                  args[_key] = arguments[_key];\n                }\n\n                return handleDisconnect.apply(wallet, args);\n              };\n\n              wallet.on('connect', connect);\n              wallet.connect().catch(reason => {\n                wallet.off('connect', connect);\n                reject(reason);\n              });\n\n              if (typeof provider === 'string') {\n                let count = 0;\n                interval = setInterval(() => {\n                  const popup = wallet._popup;\n\n                  if (popup) {\n                    if (popup.closed) reject(new WalletWindowClosedError());\n                  } else {\n                    if (count > 50) reject(new WalletWindowBlockedError());\n                  }\n\n                  count++;\n                }, 100);\n              } else {\n                // HACK: sol-wallet-adapter doesn't reject or emit an event if the extension is closed or ignored\n                timeout = setTimeout(() => reject(new WalletTimeoutError()), 10000);\n              }\n            });\n          } finally {\n            wallet.handleDisconnect = handleDisconnect;\n            if (interval) clearInterval(interval);\n          }\n        } catch (error) {\n          if (error instanceof WalletError) throw error;\n          throw new WalletConnectionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        wallet.on('disconnect', this._disconnected);\n        this._wallet = wallet;\n        this.emit('connect');\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const wallet = this._wallet;\n\n      if (wallet) {\n        wallet.off('disconnect', this._disconnected);\n        this._wallet = null; // HACK: sol-wallet-adapter doesn't reliably fulfill its promise or emit an event on disconnect\n\n        const handleDisconnect = wallet.handleDisconnect;\n\n        try {\n          yield new Promise((resolve, reject) => {\n            const timeout = setTimeout(() => resolve(), 250);\n\n            wallet.handleDisconnect = function () {\n              clearTimeout(timeout);\n              resolve(); // HACK: sol-wallet-adapter rejects with an uncaught promise error\n\n              wallet._responsePromises = new Map();\n\n              for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                args[_key2] = arguments[_key2];\n              }\n\n              return handleDisconnect.apply(wallet, args);\n            };\n\n            wallet.disconnect().then(() => {\n              clearTimeout(timeout);\n              resolve();\n            }, error => {\n              clearTimeout(timeout); // HACK: sol-wallet-adapter rejects with an error on disconnect\n\n              if ((error === null || error === void 0 ? void 0 : error.message) === 'Wallet disconnected') {\n                resolve();\n              } else {\n                reject(error);\n              }\n            });\n          });\n        } catch (error) {\n          this.emit('error', new WalletDisconnectionError(error === null || error === void 0 ? void 0 : error.message, error));\n        } finally {\n          wallet.handleDisconnect = handleDisconnect;\n        }\n      }\n\n      this.emit('disconnect');\n    });\n  }\n\n  signTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new WalletNotConnectedError();\n\n        try {\n          return (yield wallet.signTransaction(transaction)) || transaction;\n        } catch (error) {\n          throw new WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n  signAllTransactions(transactions) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new WalletNotConnectedError();\n\n        try {\n          return (yield wallet.signAllTransactions(transactions)) || transactions;\n        } catch (error) {\n          throw new WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n  signMessage(message) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new WalletNotConnectedError();\n\n        try {\n          const {\n            signature\n          } = yield wallet.sign(message, 'utf8');\n          return Uint8Array.from(signature);\n        } catch (error) {\n          throw new WalletSignMessageError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n}","map":{"version":3,"mappings":"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","names":["Wallet","BaseMessageSignerWalletAdapter","pollUntilReady","WalletAdapterNetwork","WalletConnectionError","WalletDisconnectedError","WalletDisconnectionError","WalletError","WalletNotConnectedError","WalletNotFoundError","WalletSignMessageError","WalletSignTransactionError","WalletTimeoutError","WalletWindowBlockedError","WalletWindowClosedError","SolletWalletAdapter","constructor","config","wallet","_wallet","off","_disconnected","emit","_provider","provider","window","undefined","sollet","_network","network","Mainnet","_connecting","ready","pollInterval","pollCount","publicKey","_a","postMessage","connecting","connected","connect","handleDisconnect","timeout","interval","Promise","resolve","reject","clearTimeout","args","apply","on","catch","reason","count","setInterval","popup","_popup","closed","setTimeout","clearInterval","error","message","disconnect","_responsePromises","Map","then","signTransaction","transaction","signAllTransactions","transactions","signMessage","signature","sign","Uint8Array","from"],"sourceRoot":"","sources":["../src/adapter.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}