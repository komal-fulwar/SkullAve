{"ast":null,"code":"import { splitArgsAndCtx } from \"../context\";\nimport { EventParser } from \"../event\";\nimport { ProgramError } from \"../../error\";\nexport default class SimulateFactory {\n  static build(idlIx, txFn, idlErrors, provider, coder, programId, idl) {\n    const simulate = async function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      const tx = txFn(...args);\n      const [, ctx] = splitArgsAndCtx(idlIx, [...args]);\n      let resp = undefined;\n\n      try {\n        resp = await provider.simulate(tx, ctx.signers, ctx.options);\n      } catch (err) {\n        console.log(\"Translating error\", err);\n        let translatedErr = ProgramError.parse(err, idlErrors);\n\n        if (translatedErr === null) {\n          throw err;\n        }\n\n        throw translatedErr;\n      }\n\n      if (resp === undefined) {\n        throw new Error(\"Unable to simulate transaction\");\n      }\n\n      if (resp.value.err) {\n        throw new Error(`Simulate error: ${resp.value.err.toString()}`);\n      }\n\n      const logs = resp.value.logs;\n\n      if (!logs) {\n        throw new Error(\"Simulated logs not found\");\n      }\n\n      const events = [];\n\n      if (idl.events) {\n        let parser = new EventParser(programId, coder);\n        parser.parseLogs(logs, event => {\n          events.push(event);\n        });\n      }\n\n      return {\n        events,\n        raw: logs\n      };\n    };\n\n    return simulate;\n  }\n\n}","map":{"version":3,"mappings":"AAOA,SAASA,eAAT,QAAgC,YAAhC;AAEA,SAASC,WAAT,QAAmC,UAAnC;AAGA,SAASC,YAAT,QAA6B,aAA7B;AAEA,eAAc,MAAOC,eAAP,CAAsB;AACf,SAALC,KAAK,CACjBC,KADiB,EAEjBC,IAFiB,EAGjBC,SAHiB,EAIjBC,QAJiB,EAKjBC,KALiB,EAMjBC,SANiB,EAOjBC,GAPiB,EAOT;AAER,UAAMC,QAAQ,GAAG,kBAAoD;AAAA,wCAA1CC,IAA0C;AAA1CA,YAA0C;AAAA;;AACnE,YAAMC,EAAE,GAAGR,IAAI,CAAC,GAAGO,IAAJ,CAAf;AACA,YAAM,GAAGE,GAAH,IAAUf,eAAe,CAACK,KAAD,EAAQ,CAAC,GAAGQ,IAAJ,CAAR,CAA/B;AACA,UAAIG,IAAI,GAEQC,SAFhB;;AAGA,UAAI;AACFD,YAAI,GAAG,MAAMR,QAAQ,CAACI,QAAT,CAAkBE,EAAlB,EAAsBC,GAAG,CAACG,OAA1B,EAAmCH,GAAG,CAACI,OAAvC,CAAb;AACD,OAFD,CAEE,OAAOC,GAAP,EAAY;AACZC,eAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCF,GAAjC;AACA,YAAIG,aAAa,GAAGrB,YAAY,CAACsB,KAAb,CAAmBJ,GAAnB,EAAwBb,SAAxB,CAApB;;AACA,YAAIgB,aAAa,KAAK,IAAtB,EAA4B;AAC1B,gBAAMH,GAAN;AACD;;AACD,cAAMG,aAAN;AACD;;AACD,UAAIP,IAAI,KAAKC,SAAb,EAAwB;AACtB,cAAM,IAAIQ,KAAJ,CAAU,gCAAV,CAAN;AACD;;AACD,UAAIT,IAAI,CAACU,KAAL,CAAWN,GAAf,EAAoB;AAClB,cAAM,IAAIK,KAAJ,CAAU,mBAAmBT,IAAI,CAACU,KAAL,CAAWN,GAAX,CAAeO,QAAf,EAAyB,EAAtD,CAAN;AACD;;AACD,YAAMC,IAAI,GAAGZ,IAAI,CAACU,KAAL,CAAWE,IAAxB;;AACA,UAAI,CAACA,IAAL,EAAW;AACT,cAAM,IAAIH,KAAJ,CAAU,0BAAV,CAAN;AACD;;AAED,YAAMI,MAAM,GAAY,EAAxB;;AACA,UAAIlB,GAAG,CAACkB,MAAR,EAAgB;AACd,YAAIC,MAAM,GAAG,IAAI7B,WAAJ,CAAgBS,SAAhB,EAA2BD,KAA3B,CAAb;AACAqB,cAAM,CAACC,SAAP,CAAiBH,IAAjB,EAAwBI,KAAD,IAAU;AAC/BH,gBAAM,CAACI,IAAP,CAAYD,KAAZ;AACD,SAFD;AAGD;;AACD,aAAO;AAAEH,cAAF;AAAUK,WAAG,EAAEN;AAAf,OAAP;AACD,KAnCD;;AAqCA,WAAOhB,QAAP;AACD;;AAhDiC","names":["splitArgsAndCtx","EventParser","ProgramError","SimulateFactory","build","idlIx","txFn","idlErrors","provider","coder","programId","idl","simulate","args","tx","ctx","resp","undefined","signers","options","err","console","log","translatedErr","parse","Error","value","toString","logs","events","parser","parseLogs","event","push","raw"],"sourceRoot":"","sources":["../../../../src/program/namespace/simulate.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}